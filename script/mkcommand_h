#!/bin/bash

DIR="commands/"

if [ ! -e ${DIR}commands.c ] ; then
    echo "Missing commands.c or bad directory"
    exit 1
fi

OUTFILE=${DIR}command.bas
echo -e "'\n'\n'" > $OUTFILE
echo -e "'\tAutovideo command parser header" >> $OUTFILE
echo -e "'\tAutogenerated by mkcommand_h" >> $OUTFILE
echo -e "'\n'\n'" >> $OUTFILE
grep "^CMDAPI_IMPL" ${DIR}commands.c | \
    gawk -F "[\n\b,()]" '{ print "Public Const " toupper($2) " = \t\t\t\""$3"\""}' \
    >> $OUTFILE    
echo -e "\n" >> $OUTFILE

OUTFILE=${DIR}commands.gen
echo -e "/*\n\n" > $OUTFILE
echo -e "\tAutovideo command parser header" >> $OUTFILE
echo -e "\tAutogenerated by mkcommand_h" >> $OUTFILE
echo -e "\n\n*/" >> $OUTFILE
grep "^CMDAPI_IMPL" ${DIR}commands.c | \
    gawk '{ sub("^CMDAPI_IMPL", "CMDAPI") } { print $0 }' >> $OUTFILE
echo -e "\n" >> $OUTFILE
